<%
path = params[:path].to_s
name = params[:name].to_s
privurl = "/seminars/#{path}/#{name}"

# get the seminar
s = BlackStack::Content::Seminar.where(:path=>path, :name=>name).first

# get the array of sections
a = s.sections.sort_by { |t| t.name.to_s }.select { |t| t.delete_time.nil? }

# rendered to convert markdown to html
markdown = Redcarpet::Markdown.new(Redcarpet::Render::HTML, autolink: true, tables: true)

# load preferences
publ = s.public
desc = s.description

# marked first section as seen by the logged user 
a[0].seen_by(@login.user) if a.size > 0
%>

<!-- NavBar -->
<div class="mynavbar mysticky">
	<section class="row-fluid">	
		<div class="span6">
            <%=nav3("Seminars", "/seminars", path.gsub('-', ' ').capitalize, "/seminars/#{path}", name.gsub('-', ' ').capitalize)%>
		</div>
	</section>
</div>

<!-- Section -->
<section class="row-fluid">
    <div class="span9">
        <!-- edit seminar -->
        <section class="row-fluid">
            <div class="span12 box seminar">
                <h1 class='name'><%=name.to_s.encode_html%></h1>
                <pre class='content'><%=desc.to_s.encode_html%></pre>
                <span class='path'><b>path:</b> <a href='/seminars/<%=path%>'><%=path%></a></span>
            </div>
        </section>

        <!-- draw section -->
        <%
        i = 0
        if a.size > 0
            a.each { |section|
                i += 1
                %>
                <section class="row-fluid" id='<%=i.to_s%>' name='<%=i.to_s%>'>
                    <div class="span12 box section">
                        <h1 class='name'><%=section.name.to_s.encode_html%></h1>
                        <pre class='description'><%=section.description.to_s.encode_html%></pre>
                        <span class='badge badge-<%=section.premium ? 'green' : 'blue'%>'><%=section.premium ? 'premium' : 'free'%></span> 
                        <div class='content'>
                            <%=markdown.render(section.content.to_s)%>
                        </div>
                        <div class='done'>
                            <%
                            if a.size > 1 # link to the 2nd section
                            %>
                            <center><h1><a href='<%=privurl%>#2'>Unlock Next Section!</a></h1></center>
                            <%
                            else
                            %>
                            <center><h1><a href='<%=privurl%>'>Unlock Next Section!</a></h1></center>
                            <%
                            end
                            %>
                        </div>
                    </div>
                </section>
                <%
            } # each section
        end # if a.size > 0
        %>
    </div>

    <div class="span3 box sections">
            <h4>Sections</h4>
            <%
            i = 0
            s.sections.sort_by { |t| t.name.to_s }.select { |t| t.delete_time.nil? }.each { |section|
                i += 1
                seen = section.seen_by?(@login.user)
                done = section.done_by?(@login.user)
            %>
            <section class="row-fluid section">
                <div class="span12">
                    <a href='#<%=i%>' <%=seen ? '' : 'class="disabled"'%>>
                        <i style='<%= done ? 'color:"geen"' : ''%>' class='icon-<%= !done ? 'time' : 'ok'%>'></i> <%=section.name.to_s.encode_html%>
                    </a>
                </div>
            </section>
            <%
            }
            %>
    </div>

</section>
